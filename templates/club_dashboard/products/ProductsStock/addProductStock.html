{% extends 'base_club_dashboard.html' %}
{% load static %}


{% block links %}
<link rel="stylesheet" href="{% static 'bootstrap-5.3.3/css/bootstrap.rtl.min.css'%}" integrity="sha384-dpuaG1suU0eT09tx5plTaGMLBsfDLzUCCUXOY2j/LSvXYuG6Bqs43ALlhIqAJVRb" crossorigin="anonymous">

{% comment %} <link href="{% static 'bootstrap-5.3.3/css/bootstrap.min.css'%}" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> {% endcomment %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.css" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<div class="bg-indigo-50 min-h-screen xl:pr-[20%]">
  <section class="container mx-auto px-4 pt-8">
    <h1 class="text-3xl font-bold text-indigo-800 mb-8">إضافة مخزون للمنتج</h1>
    <form method="post" enctype="multipart/form-data" class="w-full p-6">
      {% csrf_token %}
      <div class="mb-4">

        <div class="tab-content p-3" id="nav-tabContent">
          <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab"
            tabindex="0">
  
  
  
            <div id="carouselExampleIndicators" class="carousel slide carousel-dark" >
              <!-- <div class="carousel-indicators">
              <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
              <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
              <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
              </div> -->
              <div class="carousel-inner" id="profile-imgs-box">

  
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
              </button>
          </div>

        
      </div>


<!-- Button trigger modal -->
<button type="button" class="btn btn-primary mt-3" style="margin: auto;display: block;" data-bs-toggle="modal" data-bs-target="#cropImagePop">
  رفع صورة للمنتج
</button>

<!-- Modal -->
<div class="modal fade" id="cropImagePop" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">رفع صورة</h1>
        <button type="button" class="btn-close" style="margin: 0;margin-right: auto;" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="demo-wrap upload-demo">
          <div class="container">
              <div class="pull-left">
                 
                  <div >
                      <a >
                        <label for="exampleInputEmail1" class="form-label">رفع صورة</label>
                          <input type="file" id="upload" class="form-control" value="" accept="image/*" />
                      </a>

                      <input type="hidden" id="userprofile-avatar" class="form-control" >
                  </div>
              </div>
              <div class="pull-left">
                  <div class="upload-msg" onclick="document.querySelector('#upload').click()">
                      معاينة
                  </div>
                  <div class="upload-demo-wrap">
                      <div id="upload-demo"></div>
                  </div>
              </div>
          </div>
      </div>  

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">الغاء</button>
        <button type="button" class="btn btn-primary upload-result">رفع</button>
      </div>
    </div>
  </div>
</div>










      <div class="mb-4">
        <label
          for="product"
          class="block text-sm font-medium text-gray-700 mb-1"
          >المنتج</label
        >
        {{form.title}}
      </div>
      <div class="mb-4">
        <label
          for="description"
          class="block text-sm font-medium text-gray-700 mb-1"
          >الوصف</label
        >
        {{form.desc}}

      </div>
      <div class="mb-4">
        <label
          for="quantity"
          class="block text-sm font-medium text-gray-700 mb-1"
          >الكمية</label
        >
        {{form.stock}}
      </div>
      <div class="mb-4">
        <label for="price" class="block text-sm font-medium text-gray-700 mb-1"
          >السعر</label
        >
        {{form.price}}

      </div>
      <div class="mb-4">
        <label
          for="classification"
          class="block text-sm font-medium text-gray-700 mb-1"
          >التصنيف</label
        >
        {{form.classification}}

      </div>
      {% comment %} <div class="mb-4">
        <label
          for="creation_date"
          class="block text-sm font-medium text-gray-700 mb-1"
          >تاريخ الإضافة</label
        >
        <input
          type="datetime-local"
          id="creation_date"
          name="creation_date"
          required
          class="w-full px-3 py-2 border border-indigo-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
      </div> {% endcomment %}
      <div class="mb-4">
        <label for="is_enabled" class="flex items-center gap-4">
          {{form.is_enabled}}

          <span class="ml-2 text-sm font-medium text-gray-700">متاح</span>
        </label>
      </div>
      <div class="flex items-center justify-end">
        <a
          href="{% url 'viewProducts' %}"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 mr-4"
          >إلغاء</a
        >
        <button
          type="submit"
          class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"
        >
          إضافة المخزون
        </button>
      </div>
    </form>
  </section>
</div>
<script src="{% static 'bootstrap-5.3.3/js/bootstrap.bundle.min.js' %}" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>	
<script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>

<style>
  /* .croppie-container {
    display: block;
    margin: auto;
    width: 400px;
    height: 400px;
  } */
  .input-group:not(.has-validation)>.dropdown-toggle:nth-last-child(n+3),
  .input-group:not(.has-validation)>.form-floating:not(:last-child)>.form-control,
  .input-group:not(.has-validation)>.form-floating:not(:last-child)>.form-select,
  .input-group:not(.has-validation)>:not(:last-child):not(.dropdown-toggle):not(.dropdown-menu):not(.form-floating) {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
  }

  .input-group>:not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback) {
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }


  .upload-demo .upload-demo-wrap,

.upload-demo.ready .upload-msg {
    display: none;
}
.upload-demo.ready .upload-demo-wrap {
    display: block;
}
.upload-demo.ready .upload-result {
    display: block;    
}
.upload-demo-wrap {
    width: 300px;
    height: 300px;
    margin: 0 auto;
}

.upload-demo .container {
    margin-left: 0px;
    padding-left: 0px;
}

.upload-msg {
    text-align: center;
    padding: 50px;
    font-size: 22px;
    color: #aaa;
    width: 260px;
    margin: 50px auto;
    border: 1px solid #aaa;
}
#cropped-result {
  margin-top:100px;
}


.carousel {
      max-width: 300px;
      margin: auto;
      margin-top: 60px;
  }
  .carousel img {
  /* height: 200px !important; */
  /* width: 200px !important; */
  /* border-radius: 100%; */
  object-fit: cover;
  margin: auto;

}

.carousel-item-content {
  position: relative;width: 200px;margin: auto;overflow: hidden;
}

.carousel-item-content i{
  position: absolute; bottom: 0; right: 50%; transform: translate(50%, 21%); color: white; width: 100%; background: #00000066; text-align: center; height: 60px; font-size: 25px; cursor: pointer;
}
</style>

<script>
  function removeCarouselActive() {
    document.querySelectorAll('.carousel-item').forEach(element => {
      element.classList.remove('active')
    });
  }


  function CarouselOnclickRemove(id) {
    let obj = document.querySelector('#'+id)
    let IMGObj = obj.querySelector('img')
    let IMGObjs = document.querySelectorAll('.carousel-item img')
    let objs = document.querySelectorAll('.carousel-item')
    let index = -1

    IMGObjs.forEach(element => {
      index++

      if (element.children == IMGObj.children) {
        if (index > 0) {
          removeCarouselActive()
          objs[index-1].classList.add('active')
          obj.remove()
          return true
        }
      }
      
    });
  

    removeCarouselActive()
    objs.forEach(element => {
      if (element.children != IMGObj.children){
        element.classList.add('active')
      }
    })
    obj.remove()
    
  }



let imgCounter = 0
  function addProfileImg() {
    imgCounter++
    removeCarouselActive()

    html_code = `

            <div class="carousel-item active" id="cropped-result-${imgCounter}" >
              <div class="carousel-item-content">
                <img src="" class="d-block w-100" alt="...">
                <input type="hidden" name="profile_imgs" id="userprofile-avatar-${imgCounter}">
                <i class="bi bi-trash-fill" onclick="CarouselOnclickRemove('cropped-result-${imgCounter}')"></i>
              </div>
            </div>
      `
    document.getElementById('profile-imgs-box').insertAdjacentHTML('beforeend', html_code)


  }



  $(document).ready(function(){

var $uploadCrop;

function readFile(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();

    reader.onload = function (e) {
        $('.upload-demo').addClass('ready');
        $uploadCrop.croppie('bind', {
                url: e.target.result
        }).then(function(){
                console.log('jQuery bind complete');
        });

    }

    reader.readAsDataURL(input.files[0]);
  }
  else {
          console.log("Sorry - you're browser doesn't support the FileReader API");
      }
}

$uploadCrop = $('#upload-demo').croppie({
        viewport: {
                width: 200,
                height: 150,
                // type: 'circle'
        },
        enableExif: true
});

$('#upload').on('change', function () { readFile(this); });



$('.upload-result').on('click', function (ev) {
$uploadCrop.croppie('result', {
  type: 'canvas',
  size: 'viewport'
}).then(function (resp) {
  // in this hidden input we can send cropped image to server
  addProfileImg()
  // $('#userprofile-avatar').val(resp);
  // $('#cropped-result img').attr('src',resp);
  $('#userprofile-avatar-'+imgCounter).val(resp);
  $('#cropped-result-'+imgCounter+' img').attr('src',resp);
  $('#cropImagePop').modal('hide');
});
});    

});
</script>
{% endblock %}
